var marauroa=window.marauroa||{};marauroa.debug={messages:!1,unknownEvents:!0};window.console||(window.console={});window.console.log||(window.console.log=function(){},window.console.info=function(){},window.console.warn=function(){},window.console.error=function(a){alert(a)});
marauroa.util={isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},isEmptyExceptId:function(a){for(var b in a)if("id"!==b&&a.hasOwnProperty(b))return!1;return!0},first:function(a){for(var b in a)if(a.hasOwnProperty(b))return a[b]},fromProto:function(a,b){var d=function(){this.proto=a};d.prototype=a;d=new d;return b?marauroa.util.merge(d,b):d},merge:function(a,b){for(var d in b)a[d]=b[d];return a}};(function(a){var b,d,h=null,A,n,w,F,z,x,r,t,E,H,Q,D,K,M,P,Y=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],R=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],T=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],W=function(){this.list=this.next=null},X=function(){this.n=this.b=this.e=0;this.t=null},N=function(a,b,d,l,g,h){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var c=Array(this.BMAX+1),y,e,m,f,p,k,I,J=Array(this.BMAX+1),n,u,q,t=new X,v=Array(this.BMAX);f=Array(this.N_MAX);var r,w=Array(this.BMAX+1),x,A,z;z=this.root=null;for(p=0;p<c.length;p++)c[p]=0;for(p=0;p<J.length;p++)J[p]=0;for(p=0;p<v.length;p++)v[p]=null;for(p=0;p<f.length;p++)f[p]=0;for(p=0;p<
w.length;p++)w[p]=0;y=256<b?a[256]:this.BMAX;n=a;u=0;p=b;do c[n[u]]++,u++;while(0<--p);if(c[0]==b)this.root=null,this.status=this.m=0;else{for(k=1;k<=this.BMAX&&0==c[k];k++);I=k;h<k&&(h=k);for(p=this.BMAX;0!=p&&0==c[p];p--);m=p;h>p&&(h=p);for(x=1<<k;k<p;k++,x<<=1)if(0>(x-=c[k])){this.status=2;this.m=h;return}if(0>(x-=c[p]))this.status=2,this.m=h;else{c[p]+=x;w[1]=k=0;n=c;u=1;for(q=2;0<--p;)w[q++]=k+=n[u++];n=a;p=u=0;do 0!=(k=n[u++])&&(f[w[k]++]=p);while(++p<b);b=w[m];w[0]=p=0;n=f;u=0;f=-1;r=J[0]=
0;q=null;for(A=0;I<=m;I++)for(a=c[I];0<a--;){for(;I>r+J[1+f];){r+=J[1+f];f++;A=(A=m-r)>h?h:A;if((e=1<<(k=I-r))>a+1)for(e-=a+1,q=I;++k<A&&!((e<<=1)<=c[++q]);)e-=c[q];r+k>y&&r<y&&(k=y-r);A=1<<k;J[1+f]=k;q=Array(A);for(e=0;e<A;e++)q[e]=new X;z=null==z?this.root=new W:z.next=new W;z.next=null;z.list=q;v[f]=q;0<f&&(w[f]=p,t.b=J[f],t.e=16+k,t.t=q,k=(p&(1<<r)-1)>>r-J[f],v[f-1][k].e=t.e,v[f-1][k].b=t.b,v[f-1][k].n=t.n,v[f-1][k].t=t.t)}t.b=I-r;u>=b?t.e=99:n[u]<d?(t.e=256>n[u]?16:15,t.n=n[u++]):(t.e=g[n[u]-
d],t.n=l[n[u++]-d]);e=1<<I-r;for(k=p>>r;k<A;k+=e)q[k].e=t.e,q[k].b=t.b,q[k].n=t.n,q[k].t=t.t;for(k=1<<I-1;0!=(p&k);k>>=1)p^=k;for(p^=k;(p&(1<<r)-1)!=w[f];)r-=J[f],f--}this.m=J[1];this.status=0!=x&&1!=m?1:0}}},v=function(a){for(;z<a;){var b=F,d;d=M.length==P?-1:M.charCodeAt(P++)&255;F=b|d<<z;z+=8}},u=function(a){return F&Y[a]},q=function(a){F>>=a;z-=a},O=function(a,h,n){var l,g,r;if(0==n)return 0;for(r=0;;){v(D);g=H.list[u(D)];for(l=g.e;16<l;){if(99==l)return-1;q(g.b);l-=16;v(l);g=g.t[u(l)];l=g.e}q(g.b);
if(16==l)d&=32767,a[h+r++]=b[d++]=g.n;else{if(15==l)break;v(l);t=g.n+u(l);q(l);v(K);g=Q.list[u(K)];for(l=g.e;16<l;){if(99==l)return-1;q(g.b);l-=16;v(l);g=g.t[u(l)];l=g.e}q(g.b);v(l);E=d-g.n-u(l);for(q(l);0<t&&r<n;)t--,E&=32767,d&=32767,a[h+r++]=b[d++]=b[E++]}if(r==n)return n}x=-1;return r},Z=function(a,b,d){var l,g,h,c,y,e,m,f=Array(316);for(l=0;l<f.length;l++)f[l]=0;v(5);e=257+u(5);q(5);v(5);m=1+u(5);q(5);v(4);l=4+u(4);q(4);if(286<e||30<m)return-1;for(g=0;g<l;g++)v(3),f[V[g]]=u(3),q(3);for(;19>g;g++)f[V[g]]=
0;D=7;g=new N(f,19,19,null,null,D);if(0!=g.status)return-1;H=g.root;D=g.m;c=e+m;for(l=h=0;l<c;)if(v(D),y=H.list[u(D)],g=y.b,q(g),g=y.n,16>g)f[l++]=h=g;else if(16==g){v(2);g=3+u(2);q(2);if(l+g>c)return-1;for(;0<g--;)f[l++]=h}else{17==g?(v(3),g=3+u(3),q(3)):(v(7),g=11+u(7),q(7));if(l+g>c)return-1;for(;0<g--;)f[l++]=0;h=0}D=9;g=new N(f,e,257,R,S,D);0==D&&(g.status=1);if(0!=g.status)return-1;H=g.root;D=g.m;for(l=0;l<m;l++)f[l]=f[l+e];K=6;g=new N(f,m,0,T,U,K);Q=g.root;K=g.m;return 0==K&&257<e||0!=g.status?
-1:O(a,b,d)},aa=function(a,B,G){var l,g;for(l=0;l<G&&(!r||-1!=x);){if(0<t){if(0!=x)for(;0<t&&l<G;)t--,E&=32767,d&=32767,a[B+l++]=b[d++]=b[E++];else{for(;0<t&&l<G;)t--,d&=32767,v(8),a[B+l++]=b[d++]=u(8),q(8);0==t&&(x=-1)}if(l==G)break}if(-1==x){if(r)break;v(1);0!=u(1)&&(r=!0);q(1);v(2);x=u(2);q(2);H=null;t=0}switch(x){case 0:g=a;var C=B+l,c=G-l,y=void 0,y=z&7;q(y);v(16);y=u(16);q(16);v(16);if(y!=(~F&65535))g=-1;else{q(16);t=y;for(y=0;0<t&&y<c;)t--,d&=32767,v(8),g[C+y++]=b[d++]=u(8),q(8);0==t&&(x=-1);
g=y}break;case 1:if(null!=H)g=O(a,B+l,G-l);else a:{g=a;C=B+l;c=G-l;if(null==h){for(var e=void 0,y=Array(288),e=void 0,e=0;144>e;e++)y[e]=8;for(;256>e;e++)y[e]=9;for(;280>e;e++)y[e]=7;for(;288>e;e++)y[e]=8;n=7;e=new N(y,288,257,R,S,n);if(0!=e.status){alert("HufBuild error: "+e.status);g=-1;break a}h=e.root;n=e.m;for(e=0;30>e;e++)y[e]=5;w=5;e=new N(y,30,0,T,U,w);if(1<e.status){h=null;alert("HufBuild error: "+e.status);g=-1;break a}A=e.root;w=e.m}H=h;Q=A;D=n;K=w;g=O(g,C,c)}break;case 2:g=null!=H?O(a,
B+l,G-l):Z(a,B+l,G-l);break;default:g=-1}if(-1==g)return r?0:-1;l+=g}return l};a.RawDeflate||(a.RawDeflate={});a.RawDeflate.inflate=function(a){var h;null==b&&(b=Array(65536));z=F=d=0;x=-1;r=!1;t=E=0;H=null;M=a;P=0;for(var n=Array(1024),l=[];0<(a=aa(n,0,n.length));){var g=Array(a);for(h=0;h<a;h++)g[h]=String.fromCharCode(n[h]);l[l.length]=g.join("")}M=null;return l.join("")}})(this);"undefined"!==typeof module&&module.exports&&(this["encoding-indexes"]=require("./encoding-indexes.js")["encoding-indexes"]);
(function(a){function b(a,b,e){return b<=a&&a<=e}function d(a){if(void 0===a)return{};if(a===Object(a))return a;throw TypeError("Could not convert argument to dictionary");}function h(a){return 0<=a&&127>=a}function A(a){this.tokens=[].slice.call(a);this.tokens.reverse()}function n(a,b){if(a)throw TypeError("Decoder error");return b||65533}function w(a){throw TypeError("The code point "+a+" could not be encoded.");}function F(a){a=String(a).trim().toLowerCase();return Object.prototype.hasOwnProperty.call(l,
a)?l[a]:null}function z(a,b){return b?b[a]||null:null}function x(a,b){var e=b.indexOf(a);return-1===e?null:e}function r(b){if(!("encoding-indexes"in a))throw Error("Indexes missing. Did you forget to include encoding-indexes.js?");return a["encoding-indexes"][b]}function t(a,b){if(!(this instanceof t))throw TypeError("Called as a function. Did you forget 'new'?");a=void 0!==a?String(a):"utf-8";b=d(b);this._decoder=this._encoding=null;this._BOMseen=this._ignoreBOM=!1;this._error_mode="replacement";
this._do_not_flush=!1;var e=F(a);if(null===e||"replacement"===e.name)throw RangeError("Unknown encoding: "+a);if(!C[e.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");this._encoding=e;Boolean(b.fatal)&&(this._error_mode="fatal");Boolean(b.ignoreBOM)&&(this._ignoreBOM=!0);Object.defineProperty||(this.encoding=this._encoding.name.toLowerCase(),this.fatal="fatal"===this._error_mode,this.ignoreBOM=this._ignoreBOM);return this}function E(a,b){if(!(this instanceof
E))throw TypeError("Called as a function. Did you forget 'new'?");a=void 0!==a?String(a):"utf-8";b=d(b);this._encoder=this._encoding=null;this._do_not_flush=!1;this._fatal=Boolean(b.fatal)?"fatal":"replacement";var e=F(a),m;(m=null===e||"replacement"===e.name)||(m=-1===["UTF-8","UTF-16LE","UTF-16BE"].indexOf(e.name)&&!Boolean(b.NONSTANDARD_allowLegacyEncoding));if(m)throw RangeError("Unknown encoding: "+a);if(!g[e.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");
this._encoding=e;Object.defineProperty||(this.encoding=this._encoding.name.toLowerCase());return this}function H(a){var d=a.fatal,e=0,m=0,f=0,p=128,k=191;this.handler=function(a,c){if(-1===c&&0!==f)return f=0,n(d);if(-1===c)return-1;if(0===f){if(b(c,0,127))return c;if(b(c,194,223))f=1,e=c-192;else if(b(c,224,239))224===c&&(p=160),237===c&&(k=159),f=2,e=c-224;else if(b(c,240,244))240===c&&(p=144),244===c&&(k=143),f=3,e=c-240;else return n(d);e<<=6*f;return null}if(!b(c,p,k))return e=f=m=0,p=128,k=
191,a.prepend(c),n(d);p=128;k=191;m+=1;e+=c-128<<6*(f-m);if(m!==f)return null;var g=e;e=f=m=0;return g}}function Q(a){this.handler=function(a,e){if(-1===e)return-1;if(b(e,0,127))return e;var m,f;b(e,128,2047)?(m=1,f=192):b(e,2048,65535)?(m=2,f=224):b(e,65536,1114111)&&(m=3,f=240);for(f=[(e>>6*m)+f];0<m;)f.push(128|e>>6*(m-1)&63),--m;return f}}function D(a,b){var e=b.fatal;this.handler=function(b,f){if(-1===f)return-1;if(h(f))return f;var d=a[f-128];return null===d?n(e):d}}function K(a,b){this.handler=
function(b,m){if(-1===m)return-1;if(B(m))return m;var f=x(m,a);null===f&&w(m);return f+128}}function M(a){var d=a.fatal,e=0,m=0,f=0;this.handler=function(a,k){if(-1===k&&0===e&&0===m&&0===f)return-1;-1!==k||0===e&&0===m&&0===f||(f=m=e=0,n(d));var c;if(0!==f){c=null;if(b(k,48,57))if(c=10*(126*(10*(e-129)+(m-48))+(f-129))+k-48,39419<c&&189E3>c||1237575<c)c=null;else if(7457===c)c=59335;else{var g=0,l=0,t=r("gb18030"),q;for(q=0;q<t.length;++q){var u=t[q];if(u[0]<=c)g=u[0],l=u[1];else break}c=l+c-g}g=
[m,f,k];f=m=e=0;return null===c?(a.prepend(g),n(d)):c}if(0!==m){if(b(k,129,254))return f=k,null;a.prepend([m,k]);m=e=0;return n(d)}if(0!==e){if(b(k,48,57))return m=k,null;c=e;g=null;e=0;l=127>k?64:65;if(b(k,64,126)||b(k,128,254))g=190*(c-129)+(k-l);c=null===g?null:z(g,r("gb18030"));null===c&&h(k)&&a.prepend(k);return null===c?n(d):c}return h(k)?k:128===k?8364:b(k,129,254)?(e=k,null):n(d)}}function P(a,b){this.handler=function(a,m){if(-1===m)return-1;if(B(m))return m;if(58853===m)return w(m);if(b&&
8364===m)return 128;var f=x(m,r("gb18030"));if(null!==f){var c=L(f/190)+129,f=f%190;return[c,f+(63>f?64:65)]}if(b)return w(m);if(59335===m)f=7457;else{var c=f=0,d=r("gb18030"),g;for(g=0;g<d.length;++g){var h=d[g];if(h[1]<=m)f=h[1],c=h[0];else break}f=c+m-f}c=L(f/10/126/10);f-=12600*c;d=L(f/10/126);f-=1260*d;g=L(f/10);return[c+129,d+48,g+129,f-10*g+48]}}function Y(a){var d=a.fatal,e=0;this.handler=function(a,f){if(-1===f&&0!==e)return e=0,n(d);if(-1===f&&0===e)return-1;if(0!==e){var c=e,k=null;e=0;
var g=127>f?64:98;if(b(f,64,126)||b(f,161,254))k=157*(c-129)+(f-g);switch(k){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}c=null===k?null:z(k,r("big5"));null===c&&h(f)&&a.prepend(f);return null===c?n(d):c}return h(f)?f:b(f,129,254)?(e=f,null):n(d)}}function R(a){this.handler=function(a,b){if(-1===b)return-1;if(B(b))return b;var m;var f=r("big5");m=9552===b||9566===b||9569===b||9578===b||21313===b||21317===b?f.lastIndexOf(b):x(b,f);if(null===
m)return w(b);f=L(m/157)+129;if(161>f)return w(b);m%=157;return[f,m+(63>m?64:98)]}}function S(a){var d=a.fatal,e=!1,m=0;this.handler=function(a,c){if(-1===c&&0!==m)return m=0,n(d);if(-1===c&&0===m)return-1;if(142===m&&b(c,161,223))return m=0,65377+c-161;if(143===m&&b(c,161,254))return e=!0,m=c,null;if(0!==m){var k=m;m=0;var g=null;b(k,161,254)&&b(c,161,254)&&(g=z(94*(k-161)+(c-161),r(e?"jis0212":"jis0208")));e=!1;b(c,161,254)||a.prepend(c);return null===g?n(d):g}return h(c)?c:142===c||143===c||b(c,
161,254)?(m=c,null):n(d)}}function T(a){this.handler=function(a,e){if(-1===e)return-1;if(B(e))return e;if(165===e)return 92;if(8254===e)return 126;if(b(e,65377,65439))return[142,e-65377+161];8722===e&&(e=65293);var c=x(e,r("jis0208"));return null===c?w(e):[L(c/94)+161,c%94+161]}}function U(a){var d=a.fatal,e=0,m=0,f=!1;this.handler=function(a,c){switch(e){default:case 0:if(27===c)return e=5,null;if(b(c,0,127)&&14!==c&&15!==c&&27!==c)return f=!1,c;if(-1===c)return-1;f=!1;return n(d);case 1:if(27===
c)return e=5,null;if(92===c)return f=!1,165;if(126===c)return f=!1,8254;if(b(c,0,127)&&14!==c&&15!==c&&27!==c&&92!==c&&126!==c)return f=!1,c;if(-1===c)return-1;f=!1;return n(d);case 2:if(27===c)return e=5,null;if(b(c,33,95))return f=!1,65377+c-33;if(-1===c)return-1;f=!1;return n(d);case 3:if(27===c)return e=5,null;if(b(c,33,126))return f=!1,m=c,e=4,null;if(-1===c)return-1;f=!1;return n(d);case 4:if(27===c)return e=5,n(d);if(b(c,33,126)){e=3;var g=z(94*(m-33)+c-33,r("jis0208"));return null===g?n(d):
g}if(-1===c)return e=3,a.prepend(c),n(d);e=3;return n(d);case 5:if(36===c||40===c)return m=c,e=6,null;a.prepend(c);f=!1;e=0;return n(d);case 6:g=m;m=0;var h=null;40===g&&66===c&&(h=0);40===g&&74===c&&(h=1);40===g&&73===c&&(h=2);36!==g||64!==c&&66!==c||(h=3);if(null!==h)return e=e=h,g=f,f=!0,g?n(d):null;a.prepend([g,c]);f=!1;e=0;return n(d)}}}function V(a){var b=0;this.handler=function(a,c){if(-1===c&&0!==b)return a.prepend(c),b=0,[27,40,66];if(-1===c&&0===b)return-1;if(!(0!==b&&1!==b||14!==c&&15!==
c&&27!==c))return w(65533);if(0===b&&B(c))return c;if(1===b&&(B(c)&&92!==c&&126!==c||165==c||8254==c)){if(B(c))return c;if(165===c)return 92;if(8254===c)return 126}if(B(c)&&0!==b)return a.prepend(c),b=0,[27,40,66];if((165===c||8254===c)&&1!==b)return a.prepend(c),b=1,[27,40,74];8722===c&&(c=65293);var f=x(c,r("jis0208"));return null===f?w(c):2!==b?(a.prepend(c),b=2,[27,36,66]):[L(f/94)+33,f%94+33]}}function W(a){var d=a.fatal,e=0;this.handler=function(a,c){if(-1===c&&0!==e)return e=0,n(d);if(-1===
c&&0===e)return-1;if(0!==e){var g=e,k=null;e=0;var l=127>c?64:65,q=160>g?129:193;if(b(c,64,126)||b(c,128,252))k=188*(g-q)+c-l;g=null===k?null:z(k,r("jis0208"));if(null===g&&null!==k&&b(k,8836,10528))return 57344+k-8836;null===g&&h(c)&&a.prepend(c);return null===g?n(d):g}return h(c)||128===c?c:b(c,161,223)?65377+c-161:b(c,129,159)||b(c,224,252)?(e=c,null):n(d)}}function X(a){this.handler=function(a,c){if(-1===c)return-1;if(B(c)||128===c)return c;if(165===c)return 92;if(8254===c)return 126;if(b(c,65377,
65439))return c-65377+161;8722===c&&(c=65293);var d;var f=x(c,r("jis0208"));d=null===f||b(f,8272,8835)?null:f;if(null===d)return w(c);f=L(d/188);d%=188;return[f+(31>f?129:193),d+(63>d?64:65)]}}function N(a){var d=a.fatal,e=0;this.handler=function(a,c){if(-1===c&&0!==e)return e=0,n(d);if(-1===c&&0===e)return-1;if(0!==e){var g=e,k=null;e=0;b(c,65,254)&&(k=190*(g-129)+(c-65));g=null===k?null:z(k,r("euc-kr"));null===k&&h(c)&&a.prepend(c);return null===g?n(d):g}return h(c)?c:b(c,129,254)?(e=c,null):n(d)}}
function v(a){this.handler=function(a,b){if(-1===b)return-1;if(B(b))return b;var c=x(b,r("euc-kr"));return null===c?w(b):[L(c/190)+129,c%190+65]}}function u(a,b){var e=a>>8,d=a&255;return b?[e,d]:[d,e]}function q(a,d){var e=d.fatal,g=null,f=null;this.handler=function(d,k){if(-1===k&&(null!==g||null!==f))return n(e);if(-1===k&&null===g&&null===f)return-1;if(null===g)return g=k,null;var h;h=a?(g<<8)+k:(k<<8)+g;g=null;if(null!==f){var l=f;f=null;if(b(h,56320,57343))return 65536+1024*(l-55296)+(h-56320);
d.prepend(u(h,a));return n(e)}return b(h,55296,56319)?(f=h,null):b(h,56320,57343)?n(e):h}}function O(a,d){this.handler=function(e,d){if(-1===d)return-1;if(b(d,0,65535))return u(d,a);var f=u((d-65536>>10)+55296,a),g=u((d-65536&1023)+56320,a);return f.concat(g)}}function Z(a){this.handler=function(a,b){return-1===b?-1:h(b)?b:63360+b-128}}function aa(a){this.handler=function(a,c){return-1===c?-1:B(c)?c:b(c,63360,63487)?c-63360+128:w(c)}}var L=Math.floor,B=h;A.prototype={endOfStream:function(){return!this.tokens.length},
read:function(){return this.tokens.length?this.tokens.pop():-1},prepend:function(a){if(Array.isArray(a))for(;a.length;)this.tokens.push(a.pop());else this.tokens.push(a)},push:function(a){if(Array.isArray(a))for(;a.length;)this.tokens.unshift(a.shift());else this.tokens.unshift(a)}};var G=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:"csisolatin2 iso-8859-2 iso-ir-101 iso8859-2 iso88592 iso_8859-2 iso_8859-2:1987 l2 latin2".split(" "),
name:"ISO-8859-2"},{labels:"csisolatin3 iso-8859-3 iso-ir-109 iso8859-3 iso88593 iso_8859-3 iso_8859-3:1988 l3 latin3".split(" "),name:"ISO-8859-3"},{labels:"csisolatin4 iso-8859-4 iso-ir-110 iso8859-4 iso88594 iso_8859-4 iso_8859-4:1988 l4 latin4".split(" "),name:"ISO-8859-4"},{labels:"csisolatincyrillic cyrillic iso-8859-5 iso-ir-144 iso8859-5 iso88595 iso_8859-5 iso_8859-5:1988".split(" "),name:"ISO-8859-5"},{labels:"arabic asmo-708 csiso88596e csiso88596i csisolatinarabic ecma-114 iso-8859-6 iso-8859-6-e iso-8859-6-i iso-ir-127 iso8859-6 iso88596 iso_8859-6 iso_8859-6:1987".split(" "),
name:"ISO-8859-6"},{labels:"csisolatingreek ecma-118 elot_928 greek greek8 iso-8859-7 iso-ir-126 iso8859-7 iso88597 iso_8859-7 iso_8859-7:1987 sun_eu_greek".split(" "),name:"ISO-8859-7"},{labels:"csiso88598e csisolatinhebrew hebrew iso-8859-8 iso-8859-8-e iso-ir-138 iso8859-8 iso88598 iso_8859-8 iso_8859-8:1988 visual".split(" "),name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-i"},{labels:"csisolatin6 iso-8859-10 iso-ir-157 iso8859-10 iso885910 l6 latin6".split(" "),
name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:"csisolatin9 iso-8859-15 iso8859-15 iso885915 iso_8859-15 l9".split(" "),name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:"dos-874 iso-8859-11 iso8859-11 iso885911 tis-620 windows-874".split(" "),
name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:"ansi_x3.4-1968 ascii cp1252 cp819 csisolatin1 ibm819 iso-8859-1 iso-ir-100 iso8859-1 iso88591 iso_8859-1 iso_8859-1:1987 l1 latin1 us-ascii windows-1252 x-cp1252".split(" "),name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:"cp1254 csisolatin5 iso-8859-9 iso-ir-148 iso8859-9 iso88599 iso_8859-9 iso_8859-9:1989 l5 latin5 windows-1254 x-cp1254".split(" "),
name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:"chinese csgb2312 csiso58gb231280 gb2312 gb_2312 gb_2312-80 gbk iso-ir-58 x-gbk".split(" "),
name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:"csshiftjis ms932 ms_kanji shift-jis shift_jis sjis windows-31j x-sjis".split(" "),name:"Shift_JIS"}],
heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:"cseuckr csksc56011987 euc-kr iso-ir-149 korean ks_c_5601-1987 ks_c_5601-1989 ksc5601 ksc_5601 windows-949".split(" "),name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],
l={};G.forEach(function(a){a.encodings.forEach(function(a){a.labels.forEach(function(b){l[b]=a})})});var g={},C={};Object.defineProperty&&(Object.defineProperty(t.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(t.prototype,"fatal",{get:function(){return"fatal"===this._error_mode}}),Object.defineProperty(t.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}}));t.prototype.decode=function(a,b){var e;e="object"===typeof a&&a instanceof
ArrayBuffer?new Uint8Array(a):"object"===typeof a&&"buffer"in a&&a.buffer instanceof ArrayBuffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(0);b=d(b);this._do_not_flush||(this._decoder=C[this._encoding.name]({fatal:"fatal"===this._error_mode}),this._BOMseen=!1);this._do_not_flush=Boolean(b.stream);var g=new A(e);e=[];for(var f;;){f=g.read();if(-1===f)break;f=this._decoder.handler(g,f);if(-1===f)break;null!==f&&(Array.isArray(f)?e.push.apply(e,f):e.push(f))}if(!this._do_not_flush){do{f=
this._decoder.handler(g,g.read());if(-1===f)break;null!==f&&(Array.isArray(f)?e.push.apply(e,f):e.push(f))}while(!g.endOfStream());this._decoder=null}-1===["UTF-8","UTF-16LE","UTF-16BE"].indexOf(this._encoding.name)||this._ignoreBOM||this._BOMseen||(0<e.length&&65279===e[0]?(this._BOMseen=!0,e.shift()):0<e.length&&(this._BOMseen=!0));g="";for(f=0;f<e.length;++f){var h=e[f];65535>=h?g+=String.fromCharCode(h):(h-=65536,g+=String.fromCharCode((h>>10)+55296,(h&1023)+56320))}return g};Object.defineProperty&&
Object.defineProperty(E.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}});E.prototype.encode=function(a,b){a=a?String(a):"";b=d(b);this._do_not_flush||(this._encoder=g[this._encoding.name]({fatal:"fatal"===this._fatal}));this._do_not_flush=Boolean(b.stream);for(var e=a,h=String(e),f=h.length,l=0,k=[];l<f;){var n=h.charCodeAt(l);if(55296>n||57343<n)k.push(n);else if(56320<=n&&57343>=n)k.push(65533);else if(55296<=n&&56319>=n)if(l===f-1)k.push(65533);else{var q=e.charCodeAt(l+
1);56320<=q&&57343>=q?(k.push(65536+((n&1023)<<10)+(q&1023)),l+=1):k.push(65533)}l+=1}e=new A(k);for(h=[];;){f=e.read();if(-1===f)break;f=this._encoder.handler(e,f);if(-1===f)break;Array.isArray(f)?h.push.apply(h,f):h.push(f)}if(!this._do_not_flush){for(;;){f=this._encoder.handler(e,e.read());if(-1===f)break;Array.isArray(f)?h.push.apply(h,f):h.push(f)}this._encoder=null}return new Uint8Array(h)};g["UTF-8"]=function(a){return new Q(a)};C["UTF-8"]=function(a){return new H(a)};(function(){"encoding-indexes"in
a&&G.forEach(function(a){"Legacy single-byte encodings"===a.heading&&a.encodings.forEach(function(a){a=a.name;var b=r(a.toLowerCase());C[a]=function(a){return new D(b,a)};g[a]=function(a){return new K(b,a)}})})})();C.GBK=function(a){return new M(a)};g.GBK=function(a){return new P(a,!0)};g.gb18030=function(a){return new P(a)};C.gb18030=function(a){return new M(a)};g.Big5=function(a){return new R(a)};C.Big5=function(a){return new Y(a)};g["EUC-JP"]=function(a){return new T(a)};C["EUC-JP"]=function(a){return new S(a)};
g["ISO-2022-JP"]=function(a){return new V(a)};C["ISO-2022-JP"]=function(a){return new U(a)};g.Shift_JIS=function(a){return new X(a)};C.Shift_JIS=function(a){return new W(a)};g["EUC-KR"]=function(a){return new v(a)};C["EUC-KR"]=function(a){return new N(a)};g["UTF-16BE"]=function(a){return new O(!0,a)};C["UTF-16BE"]=function(a){return new q(!0,a)};g["UTF-16LE"]=function(a){return new O(!1,a)};C["UTF-16LE"]=function(a){return new q(!1,a)};g["x-user-defined"]=function(a){return new aa(a)};C["x-user-defined"]=
function(a){return new Z(a)};a.TextEncoder||(a.TextEncoder=E);a.TextDecoder||(a.TextDecoder=t);"undefined"!==typeof module&&module.exports&&(module.exports={TextEncoder:a.TextEncoder,TextDecoder:a.TextDecoder,EncodingIndexes:a["encoding-indexes"]})})(this);marauroa=window.marauroa||{};
marauroa.Deserializer=function(a){var b=0,d=new DataView(a);this.readByte=function(){b++;return d.getUInt8(b-1)};this.readShort=function(){b+=2;return d.getInt16(b-2,!0)};this.readInt=function(){b+=4;return d.getInt32(b-4,!0)};this.readByteArray=function(){var h=d.getUint32(b,!0);b+=h+4;return new DataView(a,b-h,h)};this.read255LongByteArray=function(){var h=d.getUint8(b,!0);b+=h+1;return new DataView(a,b-h,h)};this.read65536LongByteArray=function(){var a=d.getUint16(b,!0);b+=a+1};this.readFloat=
function(){b+=4;return d.getFloat32(b-4,!0)};this.readString=function(){return(new TextDecoder("utf-8")).decode(this.readByteArray())};this.read255LongString=function(){return(new TextDecoder("utf-8")).decode(this.read255LongByteArray())};this.read65536LongString=function(){return(new TextDecoder("utf-8")).decode(this.read65536LongByteArray())};this.readStringArray=function(){for(var a=this.readInt(),b=[],d=0;d<a;d++)b.push(this.readString());return b};this.readAttributes=function(a){this.readString();
for(var b=this.readInt(),d=0;d<b;d++){if(-1!==this.readShort()){console.error("RPClass not supported, yet.");break}var w=this.readString(),F=this.readString();a[w]=F}return a};this.readRPObject=function(a){this.readAttributes(a);return a}};marauroa.Deserializer.fromDeflatedBase64=function(a){a=window.atob(a);a=window.RawDeflate.inflate(a.substring(2,a.length-4));return marauroa.Deserializer.fromBinaryString(a)};marauroa.Deserializer.fromBase64=function(a){return marauroa.Deserializer.fromBinaryString(atob(a))};
marauroa.Deserializer.fromBinaryString=function(a){for(var b=a.length,d=new Uint8Array(b),h=0;h<b;h++)d[h]=a.charCodeAt(h);return new marauroa.Deserializer(d.buffer)};marauroa=window.marauroa||{};
marauroa.clientFramework={clientid:"-1",connect:function(a,b){var d="ws";"https:"===window.location.protocol&&(d="wss");null===a&&(a=window.location.hostname);null===b&&(b=window.location.port);d=new WebSocket(d+"://"+a+":"+b+"/ws/");d.onmessage=this.onMessage;d.onopen=this.onConnect;d.onclose=this.onDisonnect;this.socket=d},onConnect:function(a,b){"undefined"==typeof b?console.log("connected"):console.error("onConnect: "+a+" error: "+b)},onDisconnect:function(a,b){console.log("onDisconnect: "+a+
" error: "+b)},onLoginRequired:function(){},login:function(a,b){var d={t:"34",u:a,p:b};this.username=a;this.sendMessage(d)},onServerInfo:function(a){console.log("ServerInfo",a)},onPreviousLogins:function(a){console.log("Previous Logins",a)},onLoginFailed:function(a,b){console.error("Login failed with reason "+a+": "+b)},onMessage:function(a){a=JSON.parse(a.data);marauroa.debug.messages&&console.log("<--: ",a);if("9"===a.t||"15"===a.t)marauroa.clientFramework.clientid=a.c;"string"===typeof a?console.error("JSON error on message: "+
a):(marauroa.messageFactory.addDispatchMethod(a),a.dispatch())},sendMessage:function(a){var b={c:this.clientid,s:"1"};marauroa.util.merge(b,a);marauroa.debug.messages&&console.log("--\x3e: ",a);this.socket.send(JSON.stringify(b))},resync:function(){},chooseCharacter:function(a){this.sendMessage({t:"1",character:a})},onChooseCharacterNack:function(){console.error("Server rejected your character.")},sendAction:function(a){this.sendMessage({t:"0",a:a})},logout:function(){this.sendMessage({t:"5"})},onLogoutOutAck:function(){console.log("Server accepted logout request")},
onLogoutOutNack:function(){console.log("Server rejected logout request")},close:function(){this.socket.close()},onPerception:function(a){marauroa.perceptionHandler.apply(a)},onTransferREQ:function(a){console.log("onTransferREQ: ",a)},onTransfer:function(a){console.log("onTransfer: ",a)},onAvailableCharacterDetails:function(a){console.log("onAvailableCharacterDetails: ",a);if(marauroa.util.isEmpty(a))console.log("No character found, creating a character with the username (redefine onAvailableCharacterDetails to prevent this)."),
this.createCharacter(this.username,{});else for(var b in a)a.hasOwnProperty(b)&&this.chooseCharacter(b)},createAccount:function(a,b,d){this.sendMessage({t:"23",u:a,p:b,e:d})},onCreateAccountAck:function(a){console.log('Account "'+a+'" created successfully')},onCreateAccountNack:function(a,b){console.log('Creating Account "'+a+'" failed: ',b);alert(b.text)},createCharacter:function(a,b){this.sendMessage({t:"26",charname:a,template:b})},onCreateCharacterAck:function(a,b){console.log('Character "'+a+
'" created successfully',b)},onCreateCharacterNack:function(a,b){console.log('Creating Character "'+a+'" failed: ',b);alert(b.text)}};marauroa=window.marauroa||{};
marauroa.messageFactory=new function(){this.t14=function(){marauroa.clientFramework.onLoginFailed(this.reason,this.text)};this.t9=function(){marauroa.clientFramework.onAvailableCharacterDetails(this.characters)};this.t10=function(){console.log("Entering world")};this.t11=function(){console.log("Character selection rejected");marauroa.clientFramework.onChooseCharacterNack()};this.t13=function(){marauroa.clientFramework.onPreviousLogins(this.previousLogins)};this.t15=function(){console.log("Server send key: ",this);
marauroa.clientFramework.onLoginRequired()};this.t19=function(){marauroa.clientFramework.onPerception(this)};this.t20=function(){marauroa.clientFramework.onServerInfo(this.contents)};this.t21=function(){marauroa.clientFramework.onTransfer(this.contents)};this.t22=function(){marauroa.clientFramework.onTransferREQ(this.contents);var a={},b;for(b in this.contents)a[this.contents[b].name]="undefined"!=typeof this.contents[b].ack&&this.contents[b].ack?!0:!1;marauroa.clientFramework.sendMessage({t:"7",
contents:a})};this.t24=function(){marauroa.clientFramework.onCreateAccountAck(this.username)};this.t25=function(){marauroa.clientFramework.onCreateAccountNack(this.username,this.reason)};this.t27=function(){marauroa.clientFramework.onCreateCharacterAck(this.charname,this.template)};this.t28=function(){marauroa.clientFramework.onCreateCharacterNack(this.charname,this.reason)};this.unknownMessage=function(){console.log("Unknown message: "+JSON.stringify(this))};this.addDispatchMethod=function(a){a.dispatch=
"undefined"!=typeof marauroa.messageFactory["t"+a.t]?marauroa.messageFactory["t"+a.t]:marauroa.messageFactory.unknownMessage}};marauroa=window.marauroa||{};
marauroa.rpobjectFactory=new function(){this._default=function(){};this._default.onEvent=function(a){var b=marauroa.rpeventFactory.create(a.c),d;for(d in a.a)a.a.hasOwnProperty(d)&&(b[d]=a.a[d]),b._rpclass=a.c;for(var h in a.s)a.s.hasOwnProperty(h)&&(b[h]=a.s[h]);b.execute(this)};this._default.set=function(a,b){this[a]=b};this._default.setMapEntry=function(a,b,d){this[a][b]=d};this._default.unset=function(a){delete this[a]};this._default.unsetMapEntry=function(a,b){delete this[a][b]};this._default.destroy=
function(a){};this._default.createSlot=function(a){a=marauroa.rpslotFactory.create(a);a._parent=this;return a};this._default.init=function(){};this.create=function(a){var b=this._default;"undefined"!=typeof this[a]&&(b=this[a]);a=marauroa.util.fromProto(b);a.init();return a}};
marauroa.rpeventFactory=new function(){this._default=function(){};this._default.execute=function(a){marauroa.debug.unknownEvents&&console.log("Unhandled event: ",this," on ",a)};this.create=function(a){var b=this._default;"undefined"!=typeof this[a]&&(b=this[a]);return marauroa.util.fromProto(b)}};
marauroa.rpslotFactory=new function(){this._default=function(){this._objects=[]};this._default.add=function(a){a&&a.id&&this._objects.push(a)};this._default.get=function(a){a=this.getIndex(a);if(-1<a)return this._objects[a]};this._default.getByIndex=function(a){return this._objects[a]};this._default.count=function(){return this._objects.length};this._default.getIndex=function(a){var b,d=this._objects.length;for(b=0;b<d;b++)if(this._objects[b].id===a)return b;return-1};this._default.del=function(a){a=
this.getIndex(a);-1<a&&this._objects.splice(a,1)};this._default.first=function(){if(0<this._objects.length)return this._objects[0]};this.create=function(a){var b=this._default;"undefined"!=typeof this[a]&&(b=this[a]);b=marauroa.util.fromProto(b);b._name=a;b._objects=[];return b}};marauroa=window.marauroa||{};marauroa.perceptionListener={onAdded:function(a){return!1},onModifiedAdded:function(a,b){return!1},onModifiedDeleted:function(a,b){return!1},onDeleted:function(a){return!1},onMyRPObject:function(a,b){return!1},onClear:function(){return!1},onPerceptionBegin:function(a,b){},onPerceptionEnd:function(a,b){},onException:function(a,b){console.error(a,b)}};marauroa.currentZone={clear:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&delete this[a]}};
marauroa.perceptionHandler={apply:function(a){marauroa.perceptionListener.onPerceptionBegin(a.sync,a.s);a.sync&&!marauroa.perceptionListener.onClear()&&(marauroa.currentZone.clear(),marauroa.currentZoneName=a.zoneid);this.applyPerceptionAddedRPObjects(a);this.applyPerceptionModifiedRPObjects(a);this.applyPerceptionDeletedRPObjects(a);this.applyPerceptionMyRPObject(a);marauroa.perceptionListener.onPerceptionEnd(a.sync,a.s)},applyPerceptionAddedRPObjects:function(a){if(a.aO)for(var b in a.aO)if(a.aO.hasOwnProperty(b)&&
!marauroa.perceptionListener.onAdded(a.aO[b])){var d=marauroa.rpobjectFactory.create(a.aO[b].c);this.addChanges(d,a.aO[b]);marauroa.currentZone[a.aO[b].a.id]=d}},applyPerceptionDeletedRPObjects:function(a){if(a.dO)for(var b in a.dO)if(a.dO.hasOwnProperty(b)){var d=a.dO[b].a.id;marauroa.perceptionListener.onDeleted(a.dO[b])||(marauroa.currentZone[d].destroy(marauroa.currentZone),delete marauroa.currentZone[d])}},applyPerceptionModifiedRPObjects:function(a){if(a.dA)for(var b in a.dA)if(a.dA.hasOwnProperty(b)&&
"undefined"!=typeof marauroa.currentZone[a.dA[b].a.id]){var d=marauroa.currentZone[a.dA[b].a.id];marauroa.perceptionListener.onModifiedDeleted(a.dA[b])||this.deleteChanges(d,a.dA[b])}if(a.aA)for(b in a.aA)a.aA.hasOwnProperty(b)&&"undefined"!=typeof marauroa.currentZone[a.aA[b].a.id]&&(d=marauroa.currentZone[a.aA[b].a.id],marauroa.perceptionListener.onModifiedAdded(d,a.aA[b])||this.addChanges(d,a.aA[b]))},applyPerceptionMyRPObject:function(a){if(!marauroa.perceptionListener.onMyRPObject(a.aM,a.dM)){var b;
"undefined"!=typeof a.aM&&(b=a.aM.a.id);"undefined"!=typeof a.dM&&(b=a.dM.a.id);"undefined"!=typeof b&&(this.addMyRPObjectToWorldIfPrivate(b,a.aM),b=marauroa.currentZone[b],marauroa.me=b,this.deleteChanges(b,a.dM),this.addChanges(b,a.aM))}},addMyRPObjectToWorldIfPrivate:function(a,b){if("undefined"==typeof marauroa.currentZone[a]&&!marauroa.perceptionListener.onAdded(b))if("undefined"==typeof b)marauroa.currentZone[a]={};else{var d=marauroa.rpobjectFactory.create(b.c);marauroa.currentZone[a]=d;this.addChanges(d,
b)}},deleteChanges:function(a,b){if("undefined"!=typeof b){if("undefined"!=typeof b.a)for(var d in b.a)b.a.hasOwnProperty(d)&&"id"!=d&&"zoneid"!=d&&a.unset(d);if("undefined"!=typeof b.s)for(d in b.s)if(b.s.hasOwnProperty(d))if(marauroa.util.isEmpty(b.s[d]))a.del(b.s[d]);else for(var h in b.s[d])b.s[d].hasOwnProperty(h)&&a[d].del(b.s[d][h].a.id);if("undefined"!=typeof b.m)for(d in b.m)if(b.m.hasOwnProperty(d))if(marauroa.util.isEmpty(b.m[d].a))a.unset(b.m[d]);else for(h in b.m[d].a)b.m[d].a.hasOwnProperty(h)&&
a.unsetMapEnty(d,b.m[d].a[h])}},addChanges:function(a,b){if("undefined"!=typeof b){a._rpclass=b.c;for(var d in b.a)b.a.hasOwnProperty(d)&&("undefined"==typeof a.set?(console.warn("Object missing set(key, value)-function",a,b.a),a[d]=b.a[d]):a.set(d,b.a[d]));if("undefined"!=typeof b.m)for(d in b.m)if(b.m.hasOwnProperty(d)){"undefined"==typeof a[d]&&(a[d]={});for(var h in b.m[d].a)"zoneid"!=h&&"id"!=h&&b.m[d].a.hasOwnProperty(h)&&a.setMapEntry(d,h,b.m[d].a[h])}if("undefined"!=typeof b.s)for(d in b.s)if(b.s.hasOwnProperty(d))for(h in"undefined"==
typeof a[d]&&(a[d]=a.createSlot(d)),b.s[d])if(b.s[d].hasOwnProperty(h)){var A=b.s[d][h].a.id;if("undefined"==typeof a[d].get(A)){var n=marauroa.rpobjectFactory.create(b.s[d][h].c);n._parent=a[d];n.id=A;a[d].add(n)}this.addChanges(a[d].get(A),b.s[d][h])}if("undefined"!=typeof b.e&&"undefined"!=typeof a.onEvent)for(d in b.e)if(b.e.hasOwnProperty(d))a.onEvent(b.e[d])}}};
